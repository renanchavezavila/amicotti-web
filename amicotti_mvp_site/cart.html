<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Amicotti — Carrito</title>
  <link rel="icon" href="/assets/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>:root{--pastel:#F6F3E9}</style>
</head>
<body class="bg-white text-gray-900">
  <header class="border-b bg-[color:var(--pastel)]">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/catalogo.html" class="flex items-center gap-2"><img src="/assets/logo.png" class="w-8 h-8"><strong>Amicotti</strong></a>
      <a href="/checkout.html" class="px-3 py-2 rounded bg-rose-600 text-white">Ir a pagar</a>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4">
    <h1 class="text-xl font-semibold mb-4">Carrito de compra</h1>
    <div id="list" class="space-y-4"></div>

    <div class="mt-6 p-4 border rounded bg-gray-50 flex items-center justify-between">
      <div class="text-sm text-gray-600">Subtotal</div>
      <div id="sub" class="font-semibold">$0.00</div>
    </div>

    <div class="mt-3 flex gap-2">
      <a href="/catalogo.html" class="px-3 py-2 border rounded">Seguir comprando</a>
      <a href="/checkout.html" class="px-3 py-2 rounded bg-rose-600 text-white">Finalizar pedido</a>
      <button id="empty" class="ml-auto px-3 py-2 border rounded">Vaciar</button>
    </div>
  </main>

  <script>
    function money(n){ const x=Number(n); return (Number.isFinite(x)&&x>=0)?('$'+x.toFixed(2)):'Consultar'; }
    let CART = JSON.parse(localStorage.getItem('amicart')||'[]');

    function save(){ localStorage.setItem('amicart', JSON.stringify(CART)); }
    function chgQty(key,d){
      const i=CART.findIndex(x=>x.key===key); if(i<0) return;
      CART[i].qty += d; if(CART[i].qty<=0) CART.splice(i,1);
      save(); draw();
    }
    function removeItem(key){ CART = CART.filter(x=>x.key!==key); save(); draw(); }
    function subtotal(){ return CART.reduce((a,i)=> a + (i.precio!=null? i.precio*i.qty : 0), 0); }

    function draw(){
      const list = document.getElementById('list');
      const sub = document.getElementById('sub');
      if(!CART.length){
        list.innerHTML = `<p class="text-sm text-gray-500">Tu carrito está vacío.</p>`;
        sub.textContent = '$0.00'; return;
      }
      list.innerHTML = CART.map(it => `
        <div class="flex items-start justify-between gap-3 p-3 border rounded">
          <div>
            <div class="font-medium">${it.nombre}</div>
            <div class="text-gray-500 text-sm">${it.presentacion||''}</div>
            <div class="text-sm mt-1">${money(it.precio)}</div>
            <div class='flex items-center gap-2 mt-2'>
              <button class='border px-2 rounded' onclick="chgQty('${it.key}',-1)">−</button>
              <span>${it.qty}</span>
              <button class='border px-2 rounded' onclick="chgQty('${it.key}',1)">+</button>
            </div>
          </div>
          <div class="text-right">
            <div class="font-semibold">${it.precio!=null? money(it.precio*it.qty):''}</div>
            <button class="text-red-500 text-sm mt-2" onclick="removeItem('${it.key}')">Eliminar</button>
          </div>
        </div>
      `).join('');
      sub.textContent = money(subtotal());
    }

    document.getElementById('empty').addEventListener('click',()=>{
      if(confirm('¿Vaciar carrito?')){ CART=[]; save(); draw(); }
    });

    draw();
  </script>
</body>
</html>
