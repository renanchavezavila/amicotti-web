<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Amicotti — Salud y bienestar para tus mascotas</title>
  <meta name="description" content="Entrega rápida en Quito y Valles. Productos oficiales Royal Canin y Purina."/>
  <link rel="icon" href="assets/logo.png"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>.chip{font-size:.7rem}</style>
</head>
<body class="bg-white text-gray-900 selection:bg-rose-100 selection:text-rose-700">

<!-- Top strip -->
<div class="text-xs bg-slate-900 text-slate-200">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-1 gap-3">
    <span class="truncate">Entrega en Quito y Valles</span>
    <span class="hidden sm:inline">Pagos: <strong class="text-white">transferencia bancaria</strong> o efectivo</span>
    <a id="waTop" class="hidden md:inline underline hover:no-underline" target="_blank" rel="noopener">
      Atención por WhatsApp
    </a>
  </div>
</div>

<!-- Header -->
<header class="sticky top-0 z-40 bg-white/85 backdrop-blur border-b">
  <div class="max-w-7xl mx_auto px-4 py-2 md:py-3 flex items-center justify-between gap-3">
    <a href="index.html" class="flex items-center gap-2">
      <img src="assets/logo.png" class="w-9 h-9" alt="Amicotti"/>
      <span class="font-semibold tracking-tight">Amicotti</span>
    </a>

    <nav class="flex items-center gap-2">
      <!-- Móvil: solo Catálogo (CTA principal) -->
      <a href="catalogo.html"
         class="md:hidden px-3 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700">
        Catálogo
      </a>

      <!-- Desktop: navegación completa + Catálogo -->
      <div class="hidden md:flex items-center gap-2">
        <a href="#marcas"   class="px-3 py-2 rounded-lg hover:bg-rose-50">Marcas</a>
        <a href="#promos"   class="px-3 py-2 rounded-lg hover:bg-rose-50">Promos</a>
        <a href="#faq"      class="px-3 py-2 rounded-lg hover:bg-rose-50">Preguntas</a>
        <a href="#contacto" class="px-3 py-2 rounded-lg hover:bg-rose-50">Contacto</a>
        <button type="button" data-open-email
                class="px-3 py-2 rounded-lg hover:bg-rose-50">
          Correo
        </button>
        <a href="catalogo.html"
           class="px-3 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700">
          Catálogo
        </a>
        <a id="igBtn" href="#" target="_blank" rel="noopener"
           class="px-3 py-2 rounded-lg hover:bg-rose-50">Instagram</a>
        <a id="fbBtn" href="#" target="_blank" rel="noopener"
           class="px-3 py-2 rounded-lg hover:bg-rose-50">Facebook</a>
      </div>
    </nav>
  </div>
</header>

<!-- Hero (sin CTAs) -->
<section class="bg-gradient-to-r from-rose-50 to-rose-100 py-12 md:py-16">
  <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-8 items-center">
    <div class="space-y-6">
      <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
        Salud y bienestar <span class="text-rose-600">para tus mascotas</span>
      </h1>
      <p class="text-slate-700 text-lg">
        Entrega rápida en Quito y Valles. Productos oficiales <strong>Royal Canin</strong> y <strong>Purina</strong>.
        Compra segura y asesoría por WhatsApp.
      </p>
      <ul class="text-sm text-slate-600 grid grid-cols-1 sm:grid-cols-3 gap-2 pt-2">
        <li class="flex items-center gap-2"><span class="text-rose-600">•</span> Entrega el mismo día*</li>
        <li class="flex items-center gap-2"><span class="text-rose-600">•</span> Transferencia o efectivo</li>
        <li class="flex items-center gap-2"><span class="text-rose-600">•</span> Atención personalizada</li>
      </ul>
    </div>
    <div class="hidden md:block">
      <img src="assets/home/hero-pet.webp" alt="Gato feliz sosteniendo producto en mercado Amicotti"
           class="rounded-2xl shadow-xl" width="1400" height="900" loading="eager"
           onerror="this.onerror=null; this.src='assets/logo.png'"/>
    </div>
  </div>
</section>

<!-- Cinta info (sin número de contacto) -->
<section class="bg-white border-y">
  <div class="max-w-7xl mx-auto px-4 py-4 grid sm:grid-cols-3 gap-4 text-sm text-slate-700">
    <div><span class="font-semibold text-slate-900">Cobertura:</span> Quito y Valles</div>
    <div><span class="font-semibold text-slate-900">Horario:</span> Lun–Sáb 9:00–18:00</div>
    <div class="opacity-70">Atención por WhatsApp</div>
  </div>
</section>

<!-- Marcas -->
<section id="marcas" class="py-12 bg-white">
  <div class="max-w-7xl mx-auto px-4">
    <h2 class="text-2xl font-bold text-slate-900 flex items-center gap-3 mb-6">
      Marcas que confían en nosotros
      <span class="w-12 h-1.5 bg-rose-600 rounded-full"></span>
    </h2>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">

      <!-- Royal Canin -->
      <div class="p-4 border rounded-xl bg-slate-50 shadow-sm hover:shadow-md hover:border-rose-200 transition">
        <img
          src="assets/brands/royal.png"
          alt="Logo Royal Canin"
          class="h-12 hover:scale-[1.03] transition"
          loading="lazy"
          onerror="this.onerror=null; this.src='assets/logo.png'"/>
      </div>

      <!-- Purina -->
      <div class="p-4 border rounded-xl bg-slate-50 shadow-sm hover:shadow-md hover:border-rose-200 transition">
        <img
          src="assets/brands/purina.png"
          alt="Logo Purina"
          class="h-12 hover:scale-[1.03] transition"
          loading="lazy"
          onerror="this.onerror=null; this.src='assets/logo.png'"/>
      </div>

      <!-- Dog Chow -->
      <div class="p-4 border rounded-xl bg-slate-50 shadow-sm hover:shadow-md hover:border-rose-200 transition">
        <img
          src="assets/brands/dogchow.png"
          alt="Logo Dog Chow"
          class="h-12 hover:scale-[1.03] transition"
          loading="lazy"
          onerror="this.onerror=null; this.src='assets/logo.png'"/>
      </div>

      <!-- Cat Chow -->
      <div class="p-4 border rounded-xl bg-slate-50 shadow-sm hover:shadow-md hover:border-rose-200 transition">
        <img
          src="assets/brands/catchow.png"
          alt="Logo Cat Chow"
          class="h-12 hover:scale-[1.03] transition"
          loading="lazy"
          onerror="this.onerror=null; this.src='assets/logo.png'"/>
      </div>

    </div>
  </div>
</section>

<!-- Promos informativas (sin botones) -->
<section id="promos" class="py-12 bg-rose-50">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-slate-800">Promos de la semana</h2>
    </div>
    <div id="promoGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    <p class="text-xs text-slate-500 mt-3">* Precios mostrados aquí son referenciales.</p>
  </div>
</section>

<!-- FAQs -->
<section id="faq" class="py-14 bg-white">
  <div class="max-w-3xl mx-auto px-4">
    <h2 class="text-2xl font-bold mb-6 text-slate-800">Preguntas frecuentes</h2>
    <div class="space-y-4">
      <details class="group border rounded-lg p-4 open:shadow-sm">
        <summary class="flex cursor-pointer list-none items-center justify-between">
          <span class="font-semibold">¿Cómo funcionan los envíos?</span>
          <span class="transition group-open:rotate-180">▾</span>
        </summary>
        <p class="mt-3 text-slate-700">Entregamos en Quito y Valles el mismo día para pedidos confirmados antes de las 15:00.</p>
      </details>
      <details class="group border rounded-lg p-4">
        <summary class="flex cursor-pointer list-none items-center justify-between">
          <span class="font-semibold">¿Qué métodos de pago aceptan?</span>
          <span class="transition group-open:rotate-180">▾</span>
        </summary>
        <p class="mt-3 text-slate-700">Transferencia bancaria y efectivo contra entrega.</p>
      </details>
      <details class="group border rounded-lg p-4">
        <summary class="flex cursor-pointer list-none items-center justify-between">
          <span class="font-semibold">¿Los productos son originales?</span>
          <span class="transition group-open:rotate-180">▾</span>
        </summary>
        <p class="mt-3 text-slate-700">Sí, trabajamos con distribuidores oficiales.</p>
      </details>
    </div>
  </div>
</section>

<!-- Contacto minimal -->
<section id="contacto" class="max-w-7xl mx-auto px-4 pt-2 pb-16 grid md:grid-cols-3 gap-8">
  <div>
    <h3 class="font-semibold mb-2">Amicotti</h3>
    <p class="text-slate-600">Quito — Ecuador.</p>
  </div>
  <div>
    <h3 class="font-semibold mb-2">Atención</h3>
    <p class="text-slate-600">Canal principal: WhatsApp (icono flotante).</p>
    <button type="button" data-open-email class="mt-3 text-sm px-3 py-2 rounded-lg border hover:bg-rose-50">
      Escribir por correo
    </button>
  </div>
  <div>
    <h3 class="font-semibold mb-2">Redes</h3>
    <p class="text-slate-600">
      <a id="ig1" class="underline" target="_blank" rel="noopener">Instagram</a>
      <span id="sep1" class="mx-1">·</span>
      <a id="fb1" class="underline" target="_blank" rel="noopener">Facebook</a>
    </p>
  </div>
</section>

<!-- Footer -->
<footer class="bg-gray-950 text-gray-200">
  <div class="max-w-7xl mx-auto px-4 py-12 grid md:grid-cols-3 gap-8">
    <div>
      <img src="assets/logo.png" alt="Amicotti" class="h-9 w-auto mb-4"/>
      <p class="text-sm text-gray-400">Amicotti — Amigos sanos. Cuidado y nutrición para tus mascotas.</p>
    </div>
    <div>
      <h3 class="font-semibold mb-3">Contacto</h3>
      <ul class="space-y-2 text-sm">
        <li>Quito — Ecuador</li>
        <li class="opacity-70">WhatsApp (icono flotante)</li>
        <li>
          <button type="button" data-open-email class="underline hover:text-rose-300">
            Enviar correo
          </button>
        </li>
        <li>
          Redes:
          <a id="ig2" class="text-rose-400 hover:text-white" target="_blank" rel="noopener">Instagram</a>
          <span id="sep2" class="mx-1">·</span>
          <a id="fb2" class="text-rose-400 hover:text-white" target="_blank" rel="noopener">Facebook</a>
        </li>
      </ul>
    </div>
    <div>
      <h3 class="font-semibold mb-3">Legal</h3>
      <ul class="space-y-2 text-sm">
        <li><span class="opacity-70">Términos y condiciones</span></li>
        <li><span class="opacity-70">Política de privacidad</span></li>
      </ul>
    </div>
  </div>
  <div class="border-t border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-4 text-xs text-gray-400 flex flex-col sm:flex-row items-center justify-between gap-2">
      <p>© <span id="yy"></span> Amicotti. Todos los derechos reservados.</p>
      <p>* Aplican condiciones de cobertura y horario.</p>
    </div>
  </div>
</footer>

<!-- Botón WhatsApp flotante (único canal) -->
<a id="waFloat" class="fixed bottom-4 right-4 w-12 h-12 rounded-full bg-emerald-500 text-white grid place-items-center shadow-xl"
   target="_blank" rel="noopener" aria-label="WhatsApp">
  <!-- Ícono WhatsApp SVG -->
  <svg viewBox="0 0 32 32" width="22" height="22" fill="currentColor" aria-hidden="true">
    <path d="M19.1 17.5c-.3-.1-1.8-.9-2.1-1s-.5-.1-.7.1-.8.9-1 .9-.5 0-.8-.2a6.9 6.9 0 0 1-2-1.7 7.4 7.4 0 0 1-1.4-2.1c-.1-.3 0-.5.2-.7l.5-.6c.1-.2.2-.3.1-.5s-.5-1.4-.7-1.9c-.2-.5-.4-.4-.6-.4h-.5c-.2 0-.5.1-.8.4s-1 1-1 2.4 1 2.8 1.1 3c.1.2 2 3.1 4.8 4.3.7.3 1.2.6 1.7.7.7.2 1.3.2 1.8.1.6-.1 1.8-.7 2-1.4s.2-1.3.2-1.4-.2-.2-.5-.3zM27.5 4.5A14 14 0 0 0 4.6 27.4L2 30l2.7-.7A14 14 0 1 0 27.5 4.5zm-3.5 19A11.2 11.2 0 0 1 6.6 6.6a11.2 11.2 0 0 1 17.4 13z"/>
  </svg>
</a>

<!-- Modal de Correo -->
<div id="emailModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4" aria-hidden="true">
  <!-- Fondo -->
  <div class="absolute inset-0 bg-black/50"></div>

  <!-- Contenido -->
  <div role="dialog" aria-modal="true" aria-labelledby="emailTitle"
       class="relative w-full max-w-lg bg-white rounded-2xl shadow-xl p-6">
    <button type="button" data-close-email
            class="absolute top-3 right-3 px-2 py-1 rounded text-slate-500 hover:bg-slate-100"
            aria-label="Cerrar">✕</button>

    <div class="flex items-center gap-3 mb-4">
      <img src="assets/logo.png" alt="Amicotti" class="h-8 w-8 rounded"/>
      <h3 id="emailTitle" class="text-xl font-semibold">Escríbenos por correo</h3>
    </div>

    <p class="text-sm text-slate-600 mb-4">
      Para pedidos, reclamos o consultas. Respondemos en horario laboral.
    </p>

    <form id="emailForm" class="space-y-3">
      <div class="grid sm:grid-cols-2 gap-3">
        <div>
          <label for="em_name" class="block text-xs text-slate-600 mb-1">Nombre completo *</label>
          <input id="em_name" name="name" type="text" required
                 class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-300"/>
        </div>
        <div>
          <label for="em_email" class="block text-xs text-slate-600 mb-1">Correo electrónico *</label>
          <input id="em_email" name="email" type="email" required
                 class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-300"/>
        </div>
      </div>

      <div class="grid sm:grid-cols-2 gap-3">
        <div>
          <label for="em_type" class="block text-xs text-slate-600 mb-1">Motivo *</label>
          <select id="em_type" name="type" required
                  class="w-full rounded-lg border px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-rose-300">
            <option value="">Selecciona…</option>
            <option>Pedido</option>
            <option>Reclamo</option>
            <option>Consulta</option>
          </select>
        </div>
        <div>
          <label for="em_order" class="block text-xs text-slate-600 mb-1">Nº de pedido (opcional)</label>
          <input id="em_order" name="order" type="text"
                 class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-300"/>
        </div>
      </div>

      <div>
        <label for="em_subject" class="block text-xs text-slate-600 mb-1">Asunto *</label>
        <input id="em_subject" name="subject" type="text" required
               class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-300"/>
      </div>

      <div>
        <label for="em_message" class="block text-xs text-slate-600 mb-1">Mensaje *</label>
        <textarea id="em_message" name="message" rows="5" required
                  class="w-full rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-rose-300"></textarea>
      </div>

      <div class="flex items-center justify-between gap-3 pt-2">
        <button type="button" data-close-email
                class="px-4 py-2 rounded-lg border hover:bg-slate-50">
          Cancelar
        </button>
        <button id="em_submit" type="submit"
                class="px-4 py-2 rounded-lg bg-rose-600 text-white hover:bg-rose-700 disabled:opacity-60">
          Enviar correo
        </button>
      </div>

      <!-- Estado -->
      <p id="em_state" class="text-xs text-slate-500 mt-2 hidden"></p>
    </form>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="fixed bottom-5 left-1/2 -translate-x-1/2 z-[60] hidden">
  <div class="px-4 py-2 rounded-lg shadow-lg bg-slate-900 text-white text-sm" id="toastMsg"></div>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<!-- Datos de promos del home -->
<script src="assets/home/promos.js" defer></script>

<!-- Lógica del home + correo -->
<script>
  // --- WhatsApp con referencia de origen ---
  const WA_PHONE = "593995315716";
  function waLink(ref = 'wa_float_home', msg = null) {
    const base = `https://wa.me/${WA_PHONE}`;
    const text = msg ?? `Hola Amicotti, quisiera asesoría. [ref:${ref}]`;
    return `${base}?text=${encodeURIComponent(text)}`;
  }

  // Utils
  const safe  = (img) => { img.onerror = null; img.src = "assets/logo.png"; };
  const fmtUSD = n => (typeof n === "number") ? n.toLocaleString("en-US",{style:"currency", currency:"USD"}) : "";

  // --- Social profiles ---
  const IG_URL = "https://www.instagram.com/amicotti.uio"; // ✅ IG real
  const FB_URL = "https://www.facebook.com/profile.php?id=61575188574037"; // ✅ FB real

  function setSocialLinks(){
    const pairs = [
      ["ig1", IG_URL], ["fb1", FB_URL],
      ["ig2", IG_URL], ["fb2", FB_URL],
      ["igBtn", IG_URL], ["fbBtn", FB_URL],
    ];
    pairs.forEach(([id, url]) => {
      const el = document.getElementById(id);
      if (!el) return;
      if (url) {
        el.href = url;
        if (!el.textContent.trim())
          el.textContent = url.includes("instagram") ? "Instagram" : "Facebook";
        el.classList.remove("hidden");
      } else {
        el.classList.add("hidden");
        const sep = document.getElementById(id.replace("fb","sep"));
        if (sep) sep.classList.add("hidden");
      }
    });
  }

  function setWATop(){
    const top = document.getElementById("waTop");
    if (top) top.href = waLink('wa_top');
  }

  // --- RENDER PROMOS (restaurado) ---
  function renderPromos(){
    const wrap = document.getElementById("promoGrid");
    const data = Array.isArray(window.PROMOS_HOME) ? window.PROMOS_HOME : [];
    if(!wrap) return;

    if(data.length === 0){
      wrap.innerHTML = `<div class="text-sm text-slate-500">No hay promos disponibles por el momento.</div>`;
      return;
    }

    wrap.innerHTML = data.map(p => {
      const priceBlock = (p.price)
        ? `
          <div class="mt-2 flex items-baseline gap-2">
            <span class="text-2xl font-bold text-rose-700">${fmtUSD(p.price)}</span>
            ${p.price_old ? `<span class="text-sm line-through text-slate-400">${fmtUSD(p.price_old)}</span>` : ""}
            ${p.badge ? `<span class="text-xs px-2 py-0.5 rounded-full bg-rose-100 text-rose-700">${p.badge}</span>` : ""}
          </div>
          ${p.unit ? `<div class="text-xs text-slate-500">${p.unit}</div>` : ""}
        ` : "";

      return `
        <article class="border rounded-lg bg-white shadow-sm hover:shadow-md transition">
          <img src="${p.img}" alt="${p.title}"
               class="w-full h-64 sm:h-72 lg:h-80 object-contain p-4"
               loading="lazy" onerror="safe(this)"/>
          <div class="p-4">
            <h3 class="font-semibold">${p.title}</h3>
            <p class="text-slate-600">${p.subtitle || ""}</p>
            ${priceBlock}
          </div>
        </article>
      `;
    }).join("");
  }

  // ---------- Correo (EmailJS) ----------
 const EMAILJS_PUBLIC_KEY  = "5yJPwhQjaay9VLqIR";   // Account → API Keys
const EMAILJS_SERVICE_ID  = "service_wqxnv95";      // tu Service ID
const EMAILJS_TEMPLATE_ID = "template_zfgs1fm";      // tu Template ID

if (window.emailjs) {
  emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
}


  function showToast(msg){
    const t = document.getElementById('toast');
    const m = document.getElementById('toastMsg');
    if (!t || !m) return;
    m.textContent = msg;
    t.classList.remove('hidden');
    setTimeout(()=> t.classList.add('hidden'), 3200);
  }
<script>
// ... deja arriba lo que ya tienes ...

function showToast(msg){
  const t = document.getElementById('toast');
  const m = document.getElementById('toastMsg');
  if (!t || !m) return;
  m.textContent = msg;
  t.classList.remove('hidden');
  setTimeout(()=> t.classList.add('hidden'), 3200);
}

/* ✅ PLAN B: abre el cliente de correo del usuario con todo pre-llenado */
function fallbackMailto(payload){
  const to = "amicotti.uio@gmail.com"; // tu destino
  const subj = `[Amicotti] ${payload.type} — ${payload.subject || '(sin asunto)'} (${payload.name})`;
  const body =
    `Nombre: ${payload.name}\n` +
    `Email: ${payload.email}\n` +
    `Motivo: ${payload.type}\n` +
    `Nº de pedido: ${payload.order || '-'}\n\n` +
    `Mensaje:\n${payload.message}\n\n` +
    `---\nPágina: ${payload.page_url}\nFecha/Hora: ${payload.timestamp}`;
  window.location.href = `mailto:${to}?subject=${encodeURIComponent(subj)}&body=${encodeURIComponent(body)}`;
}
</script>

  function openEmailModal(){
    const modal = document.getElementById('emailModal');
    if (!modal) return;
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    // Focus
    setTimeout(()=> document.getElementById('em_name')?.focus(), 50);
  }

  function closeEmailModal(){
    const modal = document.getElementById('emailModal');
    if (!modal) return;
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  function wireEmailModal(){
    // Abrir desde cualquier botón con data-open-email
    document.querySelectorAll('[data-open-email]').forEach(btn=>{
      btn.addEventListener('click', openEmailModal);
    });

    // Cerrar
    document.querySelectorAll('[data-close-email]').forEach(btn=>{
      btn.addEventListener('click', closeEmailModal);
    });

    // Cerrar al click en fondo
    const modal = document.getElementById('emailModal');
    if (modal) {
      modal.addEventListener('click', (e)=>{
        if (e.target === modal) closeEmailModal();
      });
      // Esc
      window.addEventListener('keydown', (e)=>{
        if (!modal.classList.contains('hidden') && e.key === 'Escape') closeEmailModal();
      });
    }

    // Envío
   <script>
function wireEmailModal(){
  // Abrir/cerrar (déjalo como ya lo tienes) ...

  const form = document.getElementById('emailForm');
  const state = document.getElementById('em_state');
  const btn   = document.getElementById('em_submit');

  if (form && btn) {
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();

      // Arma el payload
      const payload = {
        name:    form.name.value.trim(),
        email:   form.email.value.trim(),
        subject: form.subject.value.trim(),
        type:    form.type.value,
        order:   form.order.value.trim(),
        message: form.message.value.trim(),
        page_url: window.location.href,
        timestamp: new Date().toISOString()
      };

      // Validación simple
      if (!payload.name || !payload.email || !payload.subject || !payload.type || !payload.message) {
        showToast('Completa los campos requeridos (*)');
        return;
      }

      // Estado de envío
      btn.disabled = true;
      btn.textContent = 'Enviando…';
      state?.classList.remove('hidden');
      if (state) state.textContent = 'Enviando tu mensaje, por favor espera…';

      // Si EmailJS no está disponible, vamos directo a plan B
      if (!window.emailjs) {
        fallbackMailto(payload);
        showToast('No pudimos enviar desde este dominio. Abrí tu correo 💌');
        btn.disabled = false;
        btn.textContent = 'Enviar correo';
        state?.classList.add('hidden');
        return;
      }

      try {
        const res = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload);
        if (window.gtag) window.gtag('event','email_sent',{source:'home', status:'ok'});

        showToast('¡Mensaje enviado! Te responderemos pronto.');
        form.reset();
        // cierra el modal si lo deseas:
        document.querySelector('[data-close-email]')?.click();
      } catch (err) {
        if (window.gtag) window.gtag('event','email_sent',{source:'home', status:'error'});
        console.error(err);

        // Detecta error típico de dominio/origen no permitido
        const msg = (err && (err.text || err.message)) ? String(err.text || err.message).toLowerCase() : '';
        const originBlocked = msg.includes('origin') || msg.includes('domain') || msg.includes('permission') || msg.includes('not allowed') || msg.includes('unauthorized');

        if (originBlocked) {
          fallbackMailto(payload);
          showToast('No pudimos enviar desde este dominio. Abrí tu correo 💌');
        } else {
          showToast('No se pudo enviar. Intenta más tarde o usa WhatsApp.');
          state && (state.textContent = 'Error al enviar. Intenta más tarde.');
        }
      } finally {
        btn.disabled = false;
        btn.textContent = 'Enviar correo';
        state?.classList.add('hidden');
      }
    });
  }
}
</script>

  // --- Init ---
  (function(){
    // Único WhatsApp: el flotante con ref
    const flo = document.getElementById('waFloat');
    if (flo) {
      flo.href = waLink('wa_float_home');
      if (window.gtag) {
        flo.addEventListener('click', () => window.gtag('event','wa_click',{source:'home', placement:'float'}));
      }
    }

    setWATop();
    setSocialLinks();
    wireEmailModal();

    // Asegura que PROMOS_HOME esté disponible y luego renderiza
    function afterReady(){
      if (Array.isArray(window.PROMOS_HOME)) { renderPromos(); return; }
      let tries = 0;
      const iv = setInterval(()=>{
        tries++;
        if (Array.isArray(window.PROMOS_HOME) || tries > 30){
          clearInterval(iv);
          renderPromos();
        }
      }, 100);
    }
    if (document.readyState === 'complete') afterReady();
    else window.addEventListener('load', afterReady);

    const y = document.getElementById('yy');
    if (y) y.textContent = new Date().getFullYear();
  })();
</script>

</body>
</html>
