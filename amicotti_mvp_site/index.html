<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amicotti ‚Äî Salud y bienestar para tus mascotas</title>
  <meta name="description" content="Entrega r√°pida en Quito y Valles. Compra por WhatsApp. Productos oficiales Royal Canin y Purina." />
  <link rel="icon" href="assets/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PapaParse para leer CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    .slide{opacity:0;transform:scale(1.02);transition:opacity .6s ease,transform .6s ease}
    .slide.active{opacity:1;transform:scale(1)}
    .tag{font-size:.65rem}
  </style>
</head>
<body class="bg-white text-gray-900">
  <!-- Barra superior -->
  <div class="bg-slate-900 text-white text-xs">
    <div class="container mx-auto px-4 py-2 flex items-center justify-between gap-4">
      <span>Entrega en Quito y Valles</span>
      <span>Pagos: <strong>transferencia bancaria</strong></span>
      <a id="waTop" class="underline underline-offset-2 opacity-90 hover:opacity-100" target="_blank" rel="noopener">Atenci√≥n WhatsApp</a>
    </div>
  </div>

  <!-- Header -->
  <header class="border-b bg-white/80 backdrop-blur sticky top-0 z-30">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-3">
        <img src="assets/logo.png" alt="Amicotti" class="w-10 h-10" />
        <span class="font-semibold text-lg tracking-tight">Amicotti</span>
      </a>
      <nav class="flex items-center gap-2">
        <a href="catalogo.html" class="px-4 py-2 rounded-full bg-rose-600 text-white hover:bg-rose-700">Cat√°logo</a>
        <a href="#contacto" class="px-4 py-2 rounded-full border hover:bg-slate-50">Contacto</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="container mx-auto px-4 py-10 lg:py-14 grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">
      <div>
        <h1 class="text-4xl/tight md:text-5xl/tight font-extrabold">
          Salud y bienestar <span class="text-rose-600">para tus mascotas</span>
        </h1>
        <p class="mt-3 text-slate-600 max-w-xl">
          Entrega r√°pida en Quito y Valles. Compra por WhatsApp. Productos oficiales
          <strong>Royal Canin</strong> y <strong>Purina</strong>.
        </p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="catalogo.html" class="px-5 py-3 rounded-lg bg-rose-600 text-white hover:bg-rose-700">Ver cat√°logo</a>
          <a id="waHero" target="_blank" class="px-5 py-3 rounded-lg border hover:bg-slate-50">Escr√≠benos</a>
        </div>
        <div class="mt-6 flex items-center gap-6 text-xs text-slate-500">
          <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500"></span>Entrega el mismo d√≠a*</div>
          <div class="flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500"></span>Pago seguro</div>
        </div>
      </div>

      <!-- Carrusel simple (muestra algunos productos Purina/Royal) -->
      <div class="relative aspect-[4/3] rounded-2xl border bg-slate-50 overflow-hidden">
        <img class="slide absolute inset-0 w-full h-full object-contain p-6" src="assets/purina/cat-chow-adulto-carne.webp" alt="Cat Chow Adulto Carne">
        <img class="slide absolute inset-0 w-full h-full object-contain p-6" src="assets/purina/dog-chow-adulto-cordero.webp" alt="Dog Chow Adulto Cordero">
        <img class="slide absolute inset-0 w-full h-full object-contain p-6" src="assets/purina/pro-plan-gato-urinary.webp" alt="Pro Plan Gato Urinary">
        <img class="slide absolute inset-0 w-full h-full object-contain p-6" src="assets/royal/royal-caln-feline-gato.png" alt="Royal Canin (ejemplo)">
        <img class="slide absolute inset-0 w-full h-full object-contain p-6" src="assets/royal/royal-bulldog-adult-perro.webp" alt="Royal Canin Bulldog Adulto">

        <div class="absolute bottom-3 left-0 right-0 flex justify-center gap-2">
          <span class="h-1.5 w-6 rounded-full bg-slate-300" data-dot="0"></span>
          <span class="h-1.5 w-6 rounded-full bg-slate-300" data-dot="1"></span>
          <span class="h-1.5 w-6 rounded-full bg-slate-300" data-dot="2"></span>
          <span class="h-1.5 w-6 rounded-full bg-slate-300" data-dot="3"></span>
          <span class="h-1.5 w-6 rounded-full bg-slate-300" data-dot="4"></span>
        </div>
      </div>
    </section>

    <!-- PROMOS DIN√ÅMICAS -->
    <section class="container mx-auto px-4 pb-6">
      <div class="flex items-end justify-between mb-4">
        <h2 class="text-xl font-semibold">Promos de la semana</h2>
        <a class="text-rose-600 hover:text-rose-700 text-sm" href="catalogo.html">Ver todo ‚Üí</a>
      </div>
      <div id="promosGrid" class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- JS insertar√° las cards aqu√≠ -->
      </div>
      <div id="promosMsg" class="hidden mt-3 text-sm text-slate-500">No hay promos marcadas. Mostramos destacados.</div>
    </section>

    <!-- Accesos por especie -->
    <section class="container mx-auto px-4 py-8">
      <div class="grid md:grid-cols-2 gap-4">
        <a href="catalogo.html" class="group rounded-2xl border overflow-hidden bg-gradient-to-br from-rose-50 to-white p-6 flex items-center gap-5 hover:shadow-sm">
          <img src="assets/purina/cat-chow-adulto-esterilizado.webp" class="w-24 h-24 object-contain" alt="Gatos">
          <div>
            <h3 class="text-lg font-semibold">Para gatos</h3>
            <p class="text-sm text-slate-600">Seco, h√∫medo y dietas veterinarias.</p>
          </div>
        </a>
        <a href="catalogo.html" class="group rounded-2xl border overflow-hidden bg-gradient-to-br from-amber-50 to-white p-6 flex items-center gap-5 hover:shadow-sm">
          <img src="assets/royal/royal-bulldog-puppy-perro.jpg" class="w-24 h-24 object-contain" alt="Perros">
          <div>
            <h3 class="text-lg font-semibold">Para perros</h3>
            <p class="text-sm text-slate-600">Puppy, adulto y snacks.</p>
          </div>
        </a>
      </div>
    </section>

    <!-- Marcas -->
    <section class="container mx-auto px-4 py-6">
      <h2 class="text-xs font-semibold text-slate-500 mb-3">Marcas que trabajamos</h2>
      <div class="flex flex-wrap items-center gap-6">
        <span class="text-sm text-slate-600">Royal Canin ‚Ä¢ Purina</span>
      </div>
    </section>

    <!-- Pasos -->
    <section class="container mx-auto px-4 py-10">
      <div class="grid md:grid-cols-3 gap-4">
        <div class="p-6 rounded-xl border bg-white">
          <div class="text-2xl">‚ë†</div>
          <h3 class="font-semibold mt-2">Elige</h3>
          <p class="text-sm text-slate-600">Explora el cat√°logo por marca, especie o categor√≠a.</p>
        </div>
        <div class="p-6 rounded-xl border bg-white">
          <div class="text-2xl">‚ë°</div>
          <h3 class="font-semibold mt-2">Escr√≠benos</h3>
          <p class="text-sm text-slate-600">Arma tu pedido y env√≠alo por WhatsApp para coordinar.</p>
        </div>
        <div class="p-6 rounded-xl border bg-white">
          <div class="text-2xl">‚ë¢</div>
          <h3 class="font-semibold mt-2">Recibe</h3>
          <p class="text-sm text-slate-600">Entrega en Quito y Valles. Pago por transferencia.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t">
    <div class="container mx-auto px-4 py-8 grid md:grid-cols-3 gap-6" id="contacto">
      <div>
        <h4 class="font-semibold mb-1">Amicotti</h4>
        <p class="text-sm text-slate-600">Quito ‚Äî Ecuador.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-1">Contacto</h4>
        <p class="text-sm">WhatsApp: <a id="waFoot" class="text-rose-600 hover:underline" target="_blank">+593995315716</a></p>
        <p class="text-sm">Email: amicotti.uio@gmail.com</p>
      </div>
      <div>
        <h4 class="font-semibold mb-1">Redes</h4>
        <p class="text-sm"><a class="hover:underline" href="#" target="_blank">Instagram</a> ¬∑ <a class="hover:underline" href="#" target="_blank">Facebook</a></p>
      </div>
    </div>
    <div class="text-center text-xs text-slate-500 pb-6">¬© <span id="y"></span> Amicotti.</div>
  </footer>

  <!-- WA flotante -->
  <a id="waFloat" class="fixed bottom-4 right-4 w-14 h-14 rounded-full bg-rose-600 text-white grid place-items-center shadow-lg hover:bg-rose-700" target="_blank" aria-label="WhatsApp">WA</a>

  <script>
    // ================== Config WhatsApp
    const WA_PHONE = "593995315716";
    const waUrl = (msg = "") => `https://wa.me/${WA_PHONE}${msg ? `?text=${encodeURIComponent(msg)}` : ""}`;
    document.getElementById('waTop').href   = waUrl();
    document.getElementById('waHero').href  = waUrl('Hola Amicotti üëã Quiero hacer un pedido.');
    document.getElementById('waFoot').href  = waUrl();
    document.getElementById('waFloat').href = waUrl('Hola üëã');

    // ================== Carrusel
    const slides = Array.from(document.querySelectorAll('.slide'));
    const dots   = Array.from(document.querySelectorAll('[data-dot]'));
    let idx = 0;
    const setActive = (i) => {
      slides.forEach((s, j)=> s.classList.toggle('active', j===i));
      dots.forEach((d, j)=> d.style.backgroundColor = j===i ? '#f43f5e' : '#cbd5e1');
    };
    setActive(0);
    setInterval(()=> { idx = (idx+1) % slides.length; setActive(idx); }, 3500);
    dots.forEach(d => d.addEventListener('click', ()=>{ idx = +d.dataset.dot; setActive(idx); }));

    // ================== Promos desde CSV (Purina + Royal)
    const CSV_URLS = ["/data/purina.csv", "/data/royal.csv"];
    const promosGrid = document.getElementById('promosGrid');
    const promosMsg  = document.getElementById('promosMsg');

    const t = (s='') => (s||'').toString().trim();
    const money = (n) => (typeof n === 'number' && !Number.isNaN(n)) ? `$${n.toFixed(2)}` : null;

    function parseVariants(variants){
      // soporta "500g - $5.13|1.5kg - $12.19" o "500g|1.5kg"
      if(!variants) return [];
      return variants.split('|').map(raw=>{
        const p = raw.split('-').map(x=>x.trim());
        let size = p[0] || '';
        let price = null;
        if(p[1]){
          const m = p[1].match(/[\d\.]+/);
          if(m) price = Number(m[0]);
        } else {
          // si no hay precio expl√≠cito
          price = null;
        }
        return {size, price};
      }).filter(x=>x.size);
    }

    function normalizeRow(r){
      const brand = t(r.brand).toLowerCase();
      const speciesRaw = t(r.species).toLowerCase();
      const species = /cat|gato/.test(speciesRaw) ? 'Gato' : /dog|perro/.test(speciesRaw) ? 'Perro' : '';
      const categoryRaw = t(r.category).toLowerCase();
      const catMap = {dry:'Seco', wet:'H√∫medo', veterinary:'Veterinario', treats:'Snack'};
      const category = catMap[categoryRaw] || (categoryRaw ? categoryRaw[0].toUpperCase()+categoryRaw.slice(1) : '');
      const variants = parseVariants(t(r.variants));
      const minPrice = variants.map(v=>v.price).filter(v=>v!=null).sort((a,b)=>a-b)[0] ?? null;
      const image = t(r.image_url) || 'assets/placeholder.png';
      const promo = /^(yes|si|true|1)$/i.test(t(r.promo));
      const promoBadge = t(r.promo_badge) || (promo ? 'Promo' : '');
      return {
        id:t(r.id), brand:brand==='royal'?'Royal Canin':(brand[0]?.toUpperCase()+brand.slice(1)),
        name:t(r.name), species, category, variants, minPrice, image, promo, promoBadge
      };
    }

    function cardHTML(p){
      const badge = p.promoBadge || (p.category ? p.category : '');
      const mini  = p.minPrice!=null ? `${money(p.minPrice)} <span class="text-slate-500">/ desde</span>` : 'Consultar';
      const catTag = p.species && p.category ? `${p.species} ‚Ä¢ ${p.category}` : (p.species||p.category||'');
      return `
        <article class="border rounded-xl overflow-hidden bg-white">
          <div class="p-4 grid place-items-center bg-slate-50">
            <img src="${p.image}" alt="${p.name}" class="h-36 object-contain" onerror="this.src='assets/placeholder.png'">
          </div>
          <div class="p-4">
            <div class="flex items-center gap-2 mb-1">
              ${p.promo ? `<span class="tag px-2 py-0.5 bg-rose-100 text-rose-700 rounded">${badge}</span>`:''}
              ${catTag?`<span class="tag px-2 py-0.5 bg-slate-100 text-slate-700 rounded">${catTag}</span>`:''}
            </div>
            <h3 class="font-medium leading-snug">${p.name}</h3>
            <div class="mt-1 text-sm"><strong>${mini}</strong></div>
            <div class="mt-2 text-xs text-slate-500">${p.brand||''}</div>
            <a href="catalogo.html" class="mt-3 inline-block text-sm px-3 py-2 border rounded-lg hover:bg-slate-50">Comprar</a>
          </div>
        </article>
      `;
    }

    async function loadCSV(url){
      return new Promise((resolve,reject)=>{
        Papa.parse(url,{
          download:true, header:true, skipEmptyLines:true,
          complete: res => resolve(res.data), error: reject
        });
      });
    }

    async function renderPromos(){
      try{
        const arrays = await Promise.all(CSV_URLS.map(loadCSV));
        const rows = arrays.flat().map(normalizeRow).filter(r=>r.id && r.name);
        let promos = rows.filter(r=>r.promo);

        if(promos.length===0){
          promosMsg.classList.remove('hidden'); // sin promos -> destacados
          // sample 8 al azar mezclando marcas
          rows.sort(()=>Math.random()-0.5);
          promos = rows.slice(0,8);
        }else{
          promosMsg.classList.add('hidden');
        }

        // limitar a 8
        promos = promos.slice(0,8);

        promosGrid.innerHTML = promos.map(cardHTML).join('');
      }catch(e){
        console.error(e);
        promosGrid.innerHTML = `<div class="col-span-full p-6 text-center text-sm text-slate-500 border rounded">No pudimos cargar las promos.</div>`;
      }
    }

    renderPromos();

    // A√±o footer
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>
</body>
</html>
