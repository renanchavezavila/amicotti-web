<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Amicotti — Catálogo Purina</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="assets/logo.png" />
  <style>
    .container{max-width:1200px}
    .shadow-soft{box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .variant.active{background:#fee2e2;border-color:#ef4444}
    /* Imágenes sin recortes */
    article.card img{ width:100%; height:260px; object-fit:contain; background:#f8fafc; border-radius:.75rem; }
    @media (min-width:1024px){ article.card img{ height:300px; } }
  </style>
</head>
<body class="bg-white text-slate-800">
  <script>const WA_PHONE='593995315716';</script>

  <!-- Barra superior -->
  <div class="bg-slate-900 text-slate-100 text-xs">
    <div class="container mx-auto px-4 py-2 flex items-center justify-between gap-4">
      <span>Entrega en Quito y valles</span>
      <span>Pagos: <strong>transferencia bancaria</strong></span>
      <a id="waTop" class="text-rose-300 hover:text-rose-200 underline" target="_blank" rel="noopener">Atención WhatsApp</a>
    </div>
  </div>

  <!-- Header -->
  <header class="border-b">
    <div class="container mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/index.html" class="flex items-center gap-3">
        <img src="assets/logo.png" alt="Amicotti" class="h-10 w-auto" onerror="this.style.display='none'">
        <span class="font-semibold text-xl tracking-tight">Amicotti</span>
      </a>
     <nav class="hidden md:flex items-center gap-6 text-sm">
  <a href="catalogo.html">Royal Canin</a>
  <a class="text-rose-700 font-semibold" href="purina.html">Purina</a>
  <a href="index.html#contacto">Contacto</a>
</nav>

    </div>
  </header>

  <!-- Intro -->
  <section class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold">Purina</h1>
    <p class="text-slate-600 mt-1">Cat Chow, Dog Chow, Excellent, Pro Plan, Felix, Fancy Feast y PPVD. Compra por WhatsApp.</p>
  </section>

  <!-- Buscador -->
  <section class="container mx-auto px-4 pt-2 pb-4">
    <div class="flex flex-col sm:flex-row sm:items-center gap-3">
      <label for="catalog-search" class="sr-only">Buscar en catálogo</label>
      <input id="catalog-search" type="search"
        placeholder="Buscar: purina, perro, gato, 1.5kg, urinary…"
        class="w-full sm:max-w-lg rounded-xl border px-4 py-3 outline-none focus:ring-2 focus:ring-rose-500"
        autocomplete="off"/>
      <button id="catalog-search-clear" class="px-4 py-3 rounded-xl border bg-slate-50 hover:bg-slate-100">Limpiar</button>
      <span id="catalog-search-count" class="text-sm text-slate-500 sm:ml-auto"></span>
    </div>
  </section>

  <!-- Grid -->
  <main class="container mx-auto px-4 pb-16">
    <div id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>

  <!-- Footer -->
  <footer id="contacto" class="container mx-auto px-4 py-10 text-sm border-t">
    <div class="grid sm:grid-cols-3 gap-6">
      <div>
        <h3 class="font-semibold mb-3">Amicotti</h3>
        <p>Salud y bienestar para tus mascotas. Quito — Ecuador.</p>
      </div>
      <div>
        <h3 class="font-semibold mb-3">Contacto</h3>
        <p>WhatsApp: <a id="waFooter" class="text-rose-600" target="_blank" rel="noopener"></a></p>
        <p>Email: <a class="text-rose-600" href="mailto:amicotti.uio@gmail.com">amicotti.uio@gmail.com</a></p>
      </div>
      <div>
        <h3 class="font-semibold mb-3">Redes</h3>
        <p><a class="text-rose-600" href="#" target="_blank" rel="noopener">Instagram</a> ·
           <a class="text-rose-600" href="#" target="_blank" rel="noopener">Facebook</a></p>
      </div>
    </div>
    <p class="text-xs text-slate-500 mt-6">© 2025 Amicotti.</p>
  </footer>

  <!-- WhatsApp (top/footer) -->
  <script>
    (function(){
      const url = 'https://wa.me/'+WA_PHONE+'?text='+encodeURIComponent('Hola Amicotti 👋');
      const setA = (id) => { const a=document.getElementById(id); if(a){ a.href=url; a.textContent=a.textContent||('+'+WA_PHONE); a.target='_blank'; a.rel='noopener'; } };
      setA('waTop'); setA('waFooter');
    })();
  </script>

  <!-- ============ Datos Purina desde CSV ============ -->
  <script>
    const CSV_URL = "/data/purina.csv";
    const $ = s => document.querySelector(s);
    const grid = $("#grid"), q = $("#catalog-search"), count = $("#catalog-search-count");

    const PLACEHOLDER = "data:image/svg+xml;utf8,"+encodeURIComponent(
      "<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='%23f5f5f5'/>"+
      "<text x='50%' y='50%' font-size='24' font-family='Arial' fill='%23999' text-anchor='middle' dominant-baseline='middle'>Imagen referencial</text></svg>"
    );

    // CSV esperado: id,brand,name,species,category,variants,image_url
    const parse = txt => txt.trim().split(/\r?\n/).slice(1).map(r=>{
      const cols = r.split(','); if(cols.length<7) return null;
      const [id,brand,name,species,category,variants,image_url] = cols.map(s=>s.trim());
      return {id,brand,name,species,category,variants,image_url};
    }).filter(Boolean);

    const card = p => `
    <article class="card group bg-white border rounded-2xl p-4 shadow-soft" data-id="${p.id}" data-name="${p.name}" data-brand="${p.brand}" data-animal="${p.species}">
      <img src="${p.image_url||''}" onerror="this.src='${PLACEHOLDER}'" alt="${p.name}">
      <div class="mt-4 space-y-1">
        <h3 class="font-semibold">${p.name}</h3>
        <p class="text-sm text-slate-600">${p.brand} · ${p.species==='cat'?'gato':'perro'}</p>
        <div class="flex flex-wrap gap-2 mt-1">
          ${(p.variants||'').split('|').filter(Boolean).map((v,i)=>`
            <button class="variant px-2 py-1 rounded-lg border text-xs ${i? '' : 'active'}" data-size="${v}" ${i? '' : 'aria-pressed="true"'}>${v}</button>
          `).join('')}
        </div>
        <div class="flex gap-2 mt-2">
          <a class="buy px-4 py-2 rounded-xl bg-rose-600 text-white" target="_blank" rel="noopener"
             href="https://wa.me/${WA_PHONE}?text=${encodeURIComponent('Hola Amicotti 👋 Quiero comprar: '+(p.brand||'')+' '+(p.name||''))}">
            Comprar
          </a>
        </div>
      </div>
    </article>`;

    let DATA=[];
    function render(list){
      grid.innerHTML = list.map(card).join('');
      if(count) count.textContent = `${list.length} producto${list.length===1?'':'s'}`;

      // fallback imágenes (para cards nuevas)
      document.querySelectorAll('article.card[data-id] img').forEach(img=>{
        img.loading='lazy'; img.decoding='async';
        if(!img.src) img.src=PLACEHOLDER;
      });
    }

    const norm = s => (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();
    function apply(txt){
      const t = norm(txt);
      render(!t ? DATA : DATA.filter(p => norm([p.id,p.brand,p.name,p.species,p.category,p.variants].join(' ')).includes(t)));
    }

    fetch(CSV_URL)
      .then(r => r.ok ? r.text() : Promise.reject("No se pudo cargar purina.csv"))
      .then(txt => { DATA = parse(txt); render(DATA); })
      .catch(err => { grid.innerHTML = `<p class="text-red-600">${err}</p>`; });

    q?.addEventListener('input', e => apply(e.target.value));
    $("#catalog-search-clear")?.addEventListener('click', ()=>{ q.value=''; apply(''); q.focus(); });
  </script>

  <!-- ============ Carrito (combina con otras páginas) ============ -->
  <style>
    #cartFab{ position:fixed; right:1rem; bottom:1rem; z-index:50; display:inline-flex; align-items:center; gap:.5rem;
      background:#f43f5e; color:#fff; border-radius:9999px; box-shadow:0 10px 20px rgba(244,63,94,.25); padding:.6rem .9rem; cursor:pointer; }
    #cartFab .badge{ background:#fff; color:#f43f5e; min-width:1.5rem; text-align:center; border-radius:9999px; font-weight:700; padding:.1rem .4rem; }
    #cartModal{ position:fixed; inset:0; background:rgba(15,23,42,.55); display:none; z-index:60 }
    #cartPanel{ position:absolute; right:0; top:0; height:100%; width:min(92vw,420px); background:#fff; box-shadow:-10px 0 30px rgba(0,0,0,.2); display:flex; flex-direction:column; }
    .cart-header,.cart-footer{ padding:1rem; border-bottom:1px solid #e5e7eb }
    .cart-footer{ border-top:1px solid #e5e7eb; margin-top:auto }
    .cart-items{ overflow:auto; padding:1rem; display:flex; flex-direction:column; gap:.75rem }
    .cart-item{ display:grid; grid-template-columns:1fr auto; gap:.25rem; padding:.6rem .75rem; border:1px solid #e5e7eb; border-radius:.75rem; background:#fff; }
    .cart-item small{ color:#6b7280 }
    .qty{ display:inline-flex; align-items:center; gap:.25rem; margin-left:.5rem }
    .qty button{ width:1.6rem; height:1.6rem; border-radius:.4rem; border:1px solid #e5e7eb; background:#f8fafc }
  </style>

  <div id="cartFab" aria-label="Abrir carrito"> 🛒 <span id="cartBadge" class="badge">0</span></div>
  <div id="cartModal" aria-hidden="true">
    <aside id="cartPanel">
      <div class="cart-header" style="display:flex;justify-content:space-between;align-items:center">
        <strong>Tu carrito</strong>
        <button id="cartClose" class="px-3 py-2 rounded-xl border bg-slate-50">Cerrar</button>
      </div>
      <div id="cartItems" class="cart-items"></div>
      <div class="cart-footer" style="display:grid; gap:.5rem">
        <div style="display:flex;justify-content:space-between;font-weight:700">
          <span>Total</span><span id="cartTotal">$0.00</span>
        </div>
        <div style="display:flex; gap:.5rem; flex-wrap:wrap">
          <button id="cartClear" class="px-3 py-2 rounded-xl border bg-slate-50" title="Vaciar carrito">Vaciar</button>
          <button id="cartCheckout" class="px-3 py-2 rounded-xl bg-rose-600 text-white" title="Enviar por WhatsApp">Finalizar por WhatsApp</button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    (() => {
      const KEY='amicotti_cart';
      const PHONE = WA_PHONE;
      const $ = s => document.querySelector(s);
      const parseMoney = s => Number(String(s||'').replace(/[^0-9.,-]/g,'').replace(',', '.')) || 0;
      const money = n => '$' + (Math.round((+n||0) * 100)/100).toFixed(2);

      const AMICART = (window.AMICART = window.AMICART || {});
      AMICART.get = () => { try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } };
      AMICART.set = (c) => { localStorage.setItem(KEY, JSON.stringify(c)); AMICART.refresh(); };
      AMICART.add = (item) => {
        const cart = AMICART.get();
        const found = cart.find(i => i.key === item.key);
        if(found) found.qty += (item.qty||1); else cart.push({...item, qty:item.qty||1});
        AMICART.set(cart);
      };

      const fab=$('#cartFab'), badge=$('#cartBadge'), modal=$('#cartModal');
      const closeBtn=$('#cartClose'), itemsBox=$('#cartItems'), totalEl=$('#cartTotal');
      const clearBtn=$('#cartClear'), checkout=$('#cartCheckout');

      AMICART.refresh = () => {
        const cart = AMICART.get();
        badge.textContent = cart.reduce((s,i)=> s + (i.qty||0), 0);
        if(!itemsBox || !totalEl) return;
        itemsBox.innerHTML = '';
        let total = 0;

        if(!cart.length){
          itemsBox.innerHTML = '<p class="text-slate-500">Tu carrito está vacío.</p>';
          totalEl.textContent = '$0.00'; return;
        }

        cart.forEach((it,idx)=>{
          const line = (it.qty||1) * parseMoney(it.price);
          total += line;
          const row = document.createElement('div');
          row.className='cart-item';
          row.innerHTML = `
            <div>
              <div><strong>${it.brand||''} ${it.name||''}</strong></div>
              <small>${it.size||''} · ${it.price||''}</small>
            </div>
            <div style="text-align:right">
              <div>${money(line)}</div>
              <div class="qty">
                <button class="down" aria-label="Quitar">−</button>
                <span>${it.qty||1}</span>
                <button class="up" aria-label="Sumar">+</button>
                <button class="del" aria-label="Eliminar" title="Eliminar" style="margin-left:.4rem">🗑️</button>
              </div>
            </div>`;
          row.querySelector('.down').onclick = ()=>{ const c=AMICART.get(); c[idx].qty=Math.max(1,(c[idx].qty||1)-1); AMICART.set(c); };
          row.querySelector('.up').onclick   = ()=>{ const c=AMICART.get(); c[idx].qty=(c[idx].qty||1)+1; AMICART.set(c); };
          row.querySelector('.del').onclick  = ()=>{ const c=AMICART.get(); c.splice(idx,1); AMICART.set(c); };
          itemsBox.appendChild(row);
        });

        totalEl.textContent = money(total);
      };

      AMICART.open = ()=>{ modal.style.display='block'; };
      AMICART.close= ()=>{ modal.style.display='none'; };
      fab.onclick = AMICART.open; closeBtn.onclick=AMICART.close;
      modal.addEventListener('click', e=>{ if(e.target===modal) AMICART.close(); });
      clearBtn.onclick = ()=> AMICART.set([]);
      checkout.onclick = ()=>{
        const cart=AMICART.get(); if(!cart.length){ AMICART.open(); return; }
        const lines = cart.map(i=>`• ${i.brand||''} ${i.name||''} ${i.size||''} x${i.qty||1} (${i.price||''})`).join('\n');
        const total = money(cart.reduce((s,i)=> s + parseMoney(i.price)*(i.qty||1),0));
        const msg = `Hola Amicotti 👋
Quiero confirmar mi pedido:

${lines}

Total: ${total}

Sector: [Quito/Valles]
Dirección:
Nombre y teléfono:
Pago: [Transferencia/Efectivo]
Observaciones:`;
        window.open('https://wa.me/'+PHONE+'?text='+encodeURIComponent(msg), '_blank', 'noopener');
      };

      // Inyectar “Agregar” en tarjetas
      function bindCard(card){
        if(!card || card.__bound) return; card.__bound = true;
        let add = card.querySelector('.add-to-cart');
        if(!add){
          const buy = card.querySelector('.buy');
          add = document.createElement('button');
          add.type='button'; add.className='add-to-cart px-3 py-2 rounded-xl border text-rose-600 border-rose-200';
          add.textContent='Agregar';
          if(buy && buy.parentElement) buy.parentElement.insertBefore(add,buy);
          else (card.querySelector('.actions') || card).appendChild(add);
        }
        add.addEventListener('click', ()=>{
          const variants = Array.from(card.querySelectorAll('.variant,[data-size][data-price]'));
          const sel = variants.find(v => v.getAttribute('aria-pressed')==='true' || v.classList.contains('active')) || variants[0];
          const item = {
            id: card.dataset.id||'',
            brand: card.dataset.brand||'Purina',
            name: card.dataset.name|| (card.querySelector('h3')?.textContent||'').trim(),
            size: sel?.dataset?.size || (sel?.textContent||'').trim(),
            price: sel?.dataset?.price || '' // Nota: CSV no trae precios
          };
          item.key = item.id + '|' + (item.size||'');
          AMICART.add(item);

          const prev = add.textContent; add.disabled=true; add.textContent='Agregado ✓';
          setTimeout(()=>{ add.disabled=false; add.textContent=prev; }, 900);
        });
      }
      document.querySelectorAll('article.card[data-id]').forEach(bindCard);
      const mo=new MutationObserver(m=>m.forEach(x=>x.addedNodes.forEach(n=>{
        if(n.nodeType!==1) return;
        if(n.matches?.('article.card[data-id]')) bindCard(n);
        n.querySelectorAll?.('article.card[data-id]').forEach(bindCard);
      })));
      mo.observe(document.body,{childList:true,subtree:true});

      AMICART.refresh();
      window.addEventListener('storage', e=>{ if(e.key===KEY) AMICART.refresh(); });
    })();
  </script>
</body>
</html>

